<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ETF-Builder â€“ Weltweite Kurse</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; max-width: 600px; margin: auto; }
    input, button { padding: 0.5rem; font-size: 1rem; margin-top: 1rem; }
    #result { margin-top: 2rem; }
  </style>
</head>
<body>

  <h1>ğŸ“ˆ ETF-Builder</h1>
  <p>Gib einen Aktientitel ein (z.â€¯B. Apple, BASF, Sony):</p>

  <input type="text" id="query" placeholder="Aktie suchen..." />
  <button onclick="getStock()">Suchen</button>

  <div id="result"></div>

  <script>
    const FINNHUB_KEY = 'd11marhr01qhbuvqt86gd1imarhr01qhbuvqt870';
    const TWELVE_KEY = '528d4463068641d986cdc40161490ad0';

    async function getStock() {
      const query = document.getElementById("query").value.trim();
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "â³ Suche nach '" + query + "'...";

      if (!query) {
        resultDiv.innerHTML = "âŒ Bitte gib einen Suchbegriff ein.";
        return;
      }

      try {
        // Finnhub: Symbol-Suche
        const searchRes = await fetch(`https://finnhub.io/api/v1/search?q=${query}&token=${FINNHUB_KEY}`);
        const searchData = await searchRes.json();

        if (searchData.result && searchData.result.length > 0) {
          const match = searchData.result[0];
          const symbol = match.symbol;
          const name = match.description;

          // Finnhub: Kursdaten
          const quoteRes = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${FINNHUB_KEY}`);
          const quote = await quoteRes.json();

          if (quote && quote.c && quote.c > 0) {
            resultDiv.innerHTML = `
              âœ… <strong>${name}</strong> (${symbol})<br>
              ğŸ’µ Kurs: <strong>${quote.c.toFixed(2)} USD</strong><br>
              ğŸ”¼ Hoch: ${quote.h.toFixed(2)} â€“ ğŸ”½ Tief: ${quote.l.toFixed(2)}<br>
              ğŸ“Š Quelle: Finnhub
            `;
            return;
          }
        }

        // Fallback: Twelve Data
        const tdSymbol = query.toUpperCase() + ".XETRA"; // Optional: XETRA, NSE, TSE etc.
        const tdRes = await fetch(`https://api.twelvedata.com/price?symbol=${tdSymbol}&apikey=${TWELVE_KEY}`);
        const tdData = await tdRes.json();

        if (tdData && tdData.price) {
          resultDiv.innerHTML = `
            âœ… <strong>${query}</strong> (${tdSymbol})<br>
            ğŸ’µ Kurs: <strong>${Number(tdData.price).toFixed(2)} USD</strong><br>
            ğŸ“Š Quelle: Twelve Data
          `;
        } else {
          resultDiv.innerHTML = "âŒ Keine Kursdaten gefunden â€“ weder bei Finnhub noch bei Twelve Data.";
        }

      } catch (error) {
        resultDiv.innerHTML = "âŒ Fehler beim Abrufen der Daten.";
        console.error(error);
      }
    }
  </script>

</body>
</html>
